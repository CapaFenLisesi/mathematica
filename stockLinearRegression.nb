(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 9.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[     31992,        718]
NotebookOptionsPosition[     31588,        700]
NotebookOutlinePosition[     31931,        715]
CellTagsIndexPosition[     31888,        712]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{"ClearAll", "[", " ", "fDataTimeInSec", " ", 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fDataTimeInSec", "[", "fData_", "]"}], " ", ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{"AbsoluteTime", "[", 
        RowBox[{"#", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}], "-", 
       RowBox[{"AbsoluteTime", "[", 
        RowBox[{
         RowBox[{"fData", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", 
      RowBox[{"#", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], "}"}], " ", "&"}], "/@", " ", 
   "fData"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"fDataTimeInSec", "::", "usage"}], " ", "=", " ", 
    "\"\<Take FinancialData[] output and convert all the Date's to time in \
seconds relative to first entry for subsequent manipulation\>\""}], " ", 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"ClearAll", "[", " ", "fDataAndLinearModel", 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"fDataAndLinearModel", "::", "usage"}], " ", "=", " ", 
   "\"\<For a given stock symbol, and some number of weeks, compute a least \
squares linear fit from the 'close, low and high' values for the days in that \
range.\>\""}], " ", ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"fDataAndLinearModel", "[", 
    RowBox[{"symbol_", ",", " ", "nWeeks_"}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "dateRange", ",", " ", "min", ",", " ", "max", ",", " ", "close", ",", 
       " ", "diffList", ",", "zeroList", ",", "dateFormData", ",", " ", 
       "secondsFormData", ",", " ", "lmDateForm", ",", " ", "lm", ",", " ", 
       "secondsFormLinearModel", ",", " ", 
       "secondsFormDifferenceFromLinearModel", ",", " ", 
       "dateFormLinearModel", ",", " ", "len"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"dateRange", " ", "=", " ", 
       RowBox[{
        RowBox[{"DateList", "[", "]"}], " ", "-", " ", 
        RowBox[{"{", 
         RowBox[{"0", ",", " ", "0", ",", " ", "0", ",", " ", 
          RowBox[{"24", "*", "7", "*", "nWeeks"}], ",", " ", "0", ",", " ", 
          "0"}], "}"}]}]}], " ", ";", "\[IndentingNewLine]", 
      RowBox[{"min", " ", "=", " ", 
       RowBox[{"FinancialData", "[", 
        RowBox[{"symbol", ",", " ", "\"\<Low\>\"", ",", " ", "dateRange"}], 
        "]"}]}], " ", ";", "\[IndentingNewLine]", 
      RowBox[{"max", " ", "=", " ", 
       RowBox[{"FinancialData", "[", 
        RowBox[{"symbol", ",", " ", "\"\<High\>\"", ",", " ", "dateRange"}], 
        "]"}]}], " ", ";", "\[IndentingNewLine]", 
      RowBox[{"close", " ", "=", " ", 
       RowBox[{"FinancialData", "[", 
        RowBox[{"symbol", ",", " ", "dateRange"}], "]"}]}], " ", ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dateFormData", " ", "=", " ", 
       RowBox[{"Sort", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"min", ",", " ", "max", ",", " ", "close"}], "}"}], ",", 
          " ", "1"}], "]"}], "]"}]}], " ", ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"secondsFormData", " ", "=", " ", 
       RowBox[{"fDataTimeInSec", "[", " ", "dateFormData", " ", "]"}]}], " ", 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"lm", "[", "x_", "]"}], "=", " ", 
       RowBox[{"Normal", "[", 
        RowBox[{"LinearModelFit", "[", " ", 
         RowBox[{"secondsFormData", ",", "x", ",", "x"}], " ", "]"}], "]"}]}],
       " ", ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"secondsFormLinearModel", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"lm", "[", 
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}], " ", "&"}], "/@",
         " ", "secondsFormData"}]}], " ", ";", "\[IndentingNewLine]", 
      RowBox[{"secondsFormDifferenceFromLinearModel", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "2", "]"}], "]"}], " ", "-", " ", 
            RowBox[{"lm", "[", 
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}], "}"}], " ", "&"}], "/@",
         " ", "secondsFormData"}]}], " ", ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"dateFormLinearModel", " ", "=", " ", 
       RowBox[{"Table", "[", " ", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"dateFormData", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
           RowBox[{
            RowBox[{"secondsFormLinearModel", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"i", ",", " ", "1", ",", " ", 
           RowBox[{"Length", "[", "dateFormData", "]"}]}], "}"}]}], "]"}]}], 
      " ", ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"{", 
        RowBox[{"min", ",", " ", 
         RowBox[{"lm", "[", "x", "]"}]}], "}"}], "*)"}], 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"diffList", "[", "l_", "]"}], " ", ":=", 
       RowBox[{"Table", "[", " ", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"l", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
           RowBox[{"(*", " ", "date", " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"l", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "[", 
             RowBox[{"[", "2", "]"}], "]"}], " ", "-", 
            RowBox[{"lm", "[", 
             RowBox[{
              RowBox[{"AbsoluteTime", "[", 
               RowBox[{
                RowBox[{"l", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", "-", " ", 
              RowBox[{"AbsoluteTime", "[", 
               RowBox[{
                RowBox[{"l", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}]}]}], " ", 
          RowBox[{"(*", " ", 
           RowBox[{"difference", " ", "from", " ", "linear", " ", "fit"}], 
           " ", "*)"}], "\[IndentingNewLine]", "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"i", ",", " ", "1", ",", " ", 
           RowBox[{"Length", "[", "l", "]"}]}], "}"}]}], "]"}]}], "  ", ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"len", " ", "=", " ", 
       RowBox[{"Length", "[", "min", "]"}]}], " ", ";", "\[IndentingNewLine]",
       "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"zeroList", "[", "l_", "]"}], " ", ":=", 
       RowBox[{"Table", "[", " ", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"l", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
           RowBox[{"(*", " ", "date", " ", "*)"}], "\[IndentingNewLine]", 
           "0"}], "\[IndentingNewLine]", "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"i", ",", " ", "1", ",", " ", "len"}], "}"}]}], "]"}]}], 
      "  ", ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"diffList", "[", "min", "]"}], ",", " ", 
        RowBox[{"diffList", "[", "max", "]"}], ",", " ", 
        RowBox[{"diffList", "[", "close", "]"}], ",", " ", 
        RowBox[{"zeroList", "[", "min", "]"}], ",", " ", "min", ",", " ", 
        "max", ",", " ", "close", ",", " ", "dateFormLinearModel", ",", " ", 
        RowBox[{"lm", "[", "y", "]"}]}], "}"}]}]}], " ", 
    "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"ClearAll", "[", " ", "plotLinearDifference", " ", 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"plotLinearDifference", "::", "usage"}], " ", "=", " ", 
    "\"\<Plot the difference from that linear fit for the date range, \
consuming results from fDataAndLinearModel[].  Also plot the unscaled values \
of 'close, low, high' against the linear fit.\>\""}], " ", ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"plotLinearDifference", "[", " ", 
    RowBox[{"calc_", ",", " ", "lable_", ",", " ", "nWeeks_"}], " ", "]"}], 
   " ", ":=", " ", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "dMin", ",", " ", "dMax", ",", " ", "dClose", ",", " ", "dZero", ",", 
       " ", "min", ",", " ", "max", ",", " ", "close", ",", " ", "model", ",",
        " ", "len", ",", " ", "lm"}], "}"}], ",", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "dMin", ",", " ", "dMax", ",", " ", "dClose", ",", " ", "dZero", ",", 
         " ", "min", ",", " ", "max", ",", " ", "close", ",", " ", "model", 
         ",", " ", 
         RowBox[{"lm", "[", "x_", "]"}]}], "}"}], " ", "=", " ", "calc"}], 
      " ", ";", "\[IndentingNewLine]", 
      RowBox[{"len", " ", "=", " ", 
       RowBox[{"Length", "[", "min", "]"}]}], " ", ";", "\[IndentingNewLine]",
       "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "ListPlot", "[", " ", "secondsFormDifferenceFromLinearModel", " ", 
         "]"}], ","}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", " ", 
           RowBox[{"secondsFormData", ",", 
            RowBox[{"PlotLabel", "\[Rule]", " ", "lable"}]}], " ", "]"}], ",",
           "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", " ", 
           RowBox[{"secondsFormLinearModel", ",", 
            RowBox[{"Filling", "\[Rule]", "Bottom"}], ",", " ", 
            RowBox[{"Joined", "\[Rule]", "True"}]}], " ", "]"}]}], 
         "\[IndentingNewLine]", "]"}], ","}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"DateListPlot", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "dMin", ",", " ", "dMax", ",", " ", "dClose", ",", " ", "dZero"}], 
         "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Filling", "\[Rule]", "Bottom"}], ",", " ", 
        "\[IndentingNewLine]", 
        RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
        RowBox[{"PlotLabel", "\[Rule]", " ", 
         RowBox[{"Row", "[", 
          RowBox[{"{", 
           RowBox[{
           "\"\<Lin diff: \>\"", ",", "lable", ",", " ", "\"\< (\>\"", ",", 
            "nWeeks", ",", " ", "\"\< weeks range)\>\""}], "}"}], " ", 
          "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"PlotRange", " ", "\[Rule]", " ", "Full"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"PlotLegends", "\[Rule]", 
         RowBox[{"Placed", "[", 
          RowBox[{
           RowBox[{"{", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Row", "[", 
              RowBox[{"{", 
               RowBox[{"\"\<Low = \>\"", ",", " ", 
                RowBox[{
                 RowBox[{"min", "[", 
                  RowBox[{"[", "len", "]"}], "]"}], "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "]"}], ",", " ", 
             "\[IndentingNewLine]", 
             RowBox[{"Row", "[", 
              RowBox[{"{", 
               RowBox[{"\"\<High = \>\"", ",", " ", 
                RowBox[{
                 RowBox[{"max", "[", 
                  RowBox[{"[", "len", "]"}], "]"}], "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "]"}], ",", " ", 
             "\[IndentingNewLine]", 
             RowBox[{"Row", "[", 
              RowBox[{"{", 
               RowBox[{"\"\<Close = \>\"", ",", " ", 
                RowBox[{
                 RowBox[{"close", "[", 
                  RowBox[{"[", "len", "]"}], "]"}], "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "]"}], ",", " ", 
             "\[IndentingNewLine]", 
             RowBox[{"Row", "[", 
              RowBox[{"{", "\"\<Linear fit\>\"", "}"}], "]"}]}], 
            "\[IndentingNewLine]", "}"}], ",", " ", "Right"}], 
          RowBox[{"(*", 
           RowBox[{"{", 
            RowBox[{"Left", ",", " ", "Top"}], "}"}], "*)"}], "]"}]}]}], 
       "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"GraphicsRow", "[", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"fDataAndLinearModel", "[", " ", 
        RowBox[{
        "\"\<ssys\>\"", ",", " ", "\"\<Stratasys\>\"", ",", " ", "8"}], " ", 
        "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"fDataAndLinearModel", "[", " ", 
        RowBox[{
        "\"\<ssys\>\"", ",", " ", "\"\<Stratasys\>\"", ",", " ", "4"}], " ", 
        "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"fDataAndLinearModel", "[", " ", 
        RowBox[{
        "\"\<ssys\>\"", ",", " ", "\"\<Stratasys\>\"", ",", " ", "2"}], " ", 
        "]"}]}], "}"}], "]"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"GraphicsRow", "[", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"fDataAndLinearModel", "[", " ", 
        RowBox[{
        "\"\<ddd\>\"", ",", " ", "\"\<3D systems\>\"", ",", " ", "8"}], " ", 
        "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"fDataAndLinearModel", "[", " ", 
        RowBox[{
        "\"\<ddd\>\"", ",", " ", "\"\<3D systems\>\"", ",", " ", "4"}], " ", 
        "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"fDataAndLinearModel", "[", " ", 
        RowBox[{
        "\"\<ddd\>\"", ",", " ", "\"\<3D systems\>\"", ",", " ", "2"}], " ", 
        "]"}]}], "}"}], "]"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"GraphicsRow", "[", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"fDataAndLinearModel", "[", " ", 
        RowBox[{"\"\<vjet\>\"", ",", " ", "\"\<voxeljet\>\"", ",", " ", "8"}],
         " ", "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"fDataAndLinearModel", "[", " ", 
        RowBox[{"\"\<vjet\>\"", ",", " ", "\"\<voxeljet\>\"", ",", " ", "4"}],
         " ", "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"fDataAndLinearModel", "[", " ", 
        RowBox[{"\"\<vjet\>\"", ",", " ", "\"\<voxeljet\>\"", ",", " ", "2"}],
         " ", "]"}]}], "}"}], "]"}], "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"GraphicsRow", "[", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"fDataAndLinearModel", "[", " ", 
        RowBox[{"\"\<IBM\>\"", ",", " ", "\"\<IBM\>\"", ",", " ", "8"}], " ", 
        "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"fDataAndLinearModel", "[", " ", 
        RowBox[{"\"\<IBM\>\"", ",", " ", "\"\<IBM\>\"", ",", " ", "4"}], " ", 
        "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"fDataAndLinearModel", "[", " ", 
        RowBox[{"\"\<IBM\>\"", ",", " ", "\"\<IBM\>\"", ",", " ", "2"}], " ", 
        "]"}]}], "}"}], "]"}]}], "*)"}]}]}], "Input",
 CellChangeTimes->{{3.594155853585126*^9, 3.5941558631266713`*^9}, {
   3.5941559033439713`*^9, 3.594155973928009*^9}, {3.5941560425479336`*^9, 
   3.5941560426169376`*^9}, {3.5941587209831314`*^9, 3.594158733560851*^9}, {
   3.5941589019984846`*^9, 3.5941590466597586`*^9}, {3.5941590909742937`*^9, 
   3.594159094745509*^9}, {3.594159127415378*^9, 3.594159127435379*^9}, {
   3.59415915944621*^9, 3.594159238228716*^9}, {3.594159275560851*^9, 
   3.594159407259384*^9}, {3.5941594420413733`*^9, 3.594159684492241*^9}, {
   3.59415990126964*^9, 3.5941599018786745`*^9}, 3.594160053438343*^9, {
   3.5941681740318146`*^9, 3.594168240782633*^9}, {3.59416831766403*^9, 
   3.5941683483217835`*^9}, {3.5941683822227225`*^9, 
   3.5941684133575034`*^9}, {3.594168448471512*^9, 3.5941684524497395`*^9}, {
   3.594168503001631*^9, 3.5941685362365313`*^9}, {3.5941685680943537`*^9, 
   3.5941686798687468`*^9}, {3.594168725626364*^9, 3.594168860473077*^9}, {
   3.594168899217293*^9, 3.594168916846301*^9}, {3.594168997494914*^9, 
   3.5941690984556885`*^9}, {3.5941691425762124`*^9, 3.594169146957463*^9}, {
   3.5941691878678026`*^9, 3.5941691924210634`*^9}, {3.594169243371978*^9, 
   3.5941693384684167`*^9}, {3.5941693736784306`*^9, 
   3.5941694550420847`*^9}, {3.594169495923423*^9, 3.5941696439218874`*^9}, {
   3.594170173155158*^9, 3.594170259802114*^9}, {3.594170604280817*^9, 
   3.594170615463457*^9}, {3.5941710843542757`*^9, 3.5941711308919373`*^9}, {
   3.5941713215198407`*^9, 3.5941714866312847`*^9}, {3.5941724859584427`*^9, 
   3.594172512605967*^9}, {3.594215608539096*^9, 3.5942156746398764`*^9}, {
   3.5942157075227575`*^9, 3.594215711098962*^9}, {3.5942157825520487`*^9, 
   3.5942159568890204`*^9}, {3.5942160346044655`*^9, 3.59421612910087*^9}, 
   3.59421783968471*^9, {3.59421795034604*^9, 3.594218001773981*^9}, {
   3.5942180391141167`*^9, 3.5942180631154895`*^9}, {3.5942181062269554`*^9, 
   3.5942182858122272`*^9}, {3.5942183189341216`*^9, 
   3.5942184976673446`*^9}, {3.5942185632390947`*^9, 
   3.5942186828269353`*^9}, {3.5942187228312235`*^9, 
   3.5942188895457587`*^9}, {3.5942189790458775`*^9, 
   3.5942189827790914`*^9}, {3.594219020329239*^9, 3.5942190792186074`*^9}, {
   3.594219138346989*^9, 3.5942192694424877`*^9}, {3.594219311057868*^9, 
   3.594219424197339*^9}, {3.5942195854555626`*^9, 3.594219602866558*^9}, {
   3.5942577425597544`*^9, 3.594257742635759*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"fDataAndLinearModel", "[", " ", 
   RowBox[{
   "\"\<TOR:CA:CJR.B\>\"", ",", " ", "\"\<Corus\>\"", ",", " ", "52"}], " ", 
   "]"}], "*)"}]], "Input",
 CellChangeTimes->{{3.5941717410478363`*^9, 3.5941718019053173`*^9}, 
   3.5941719678088064`*^9, 3.594218416005674*^9}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"Clear", "[", " ", "plotDistAgainstLinearModel", " ", 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"plotDistAgainstLinearModel", "::", "usage"}], " ", "=", " ", 
    "\"\<Plot the unscaled values of 'close, low, high' against the linear \
fit, consuming results from fDataAndLinearModel[]\>\""}], " ", ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"plotDistAgainstLinearModel", "[", " ", 
    RowBox[{"calc_", ",", " ", "lable_", ",", " ", "nWeeks_"}], " ", "]"}], 
   " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "dMin", ",", " ", "dMax", ",", " ", "dClose", ",", " ", "dZero", ",", 
       " ", "min", ",", " ", "max", ",", " ", "close", ",", " ", "model", ",",
        " ", "lm", ",", " ", "len", ",", " ", "dr", ",", " ", "vMin", ",", 
       " ", "vMax", ",", " ", "dateFormLinearModel", ",", " ", "lmx", ",", 
       " ", "horizonLine"}], "}"}], ",", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "dMin", ",", " ", "dMax", ",", " ", "dClose", ",", " ", "dZero", ",", 
         " ", "min", ",", " ", "max", ",", " ", "close", ",", " ", "model", 
         ",", " ", "lm"}], "}"}], " ", "=", " ", "calc"}], " ", ";", 
      "\[IndentingNewLine]", 
      RowBox[{"len", " ", "=", " ", 
       RowBox[{"Length", "[", "min", "]"}]}], " ", ";", "\[IndentingNewLine]", 
      RowBox[{"dr", " ", "=", " ", 
       RowBox[{
        RowBox[{"DateList", "[", "]"}], " ", "+", " ", 
        RowBox[{"{", 
         RowBox[{"0", ",", " ", "0", ",", " ", "0", ",", " ", 
          RowBox[{"24", "*", "7", "*", 
           RowBox[{"nWeeks", "/", "2"}]}], ",", " ", "0", ",", " ", "0"}], 
         "}"}]}]}], " ", ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"vMin", " ", "=", "  ", 
       RowBox[{"Min", "[", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"min", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"i", ",", " ", "1", ",", " ", "len"}], "}"}]}], "]"}], " ",
         "]"}]}], " ", ";", "\[IndentingNewLine]", 
      RowBox[{"vMax", " ", "=", "  ", 
       RowBox[{"Max", "[", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"max", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"i", ",", " ", "1", ",", " ", "len"}], "}"}]}], "]"}], " ",
         "]"}]}], " ", ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"lmx", "[", "w_", "]"}], " ", "=", " ", 
       RowBox[{"lm", " ", "/.", " ", 
        RowBox[{"y", " ", "\[Rule]", " ", "w"}]}]}], " ", ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"dateFormLinearModel", "[", "o_", "]"}], " ", "=", " ", 
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"dMin", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
           RowBox[{
            RowBox[{"lmx", "[", "0", "]"}], "+", "o"}]}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"dr", ",", " ", 
           RowBox[{
            RowBox[{"lmx", "[", 
             RowBox[{
              RowBox[{"AbsoluteTime", "[", "dr", "]"}], "-", 
              RowBox[{"AbsoluteTime", "[", 
               RowBox[{
                RowBox[{"dMin", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}], " ", "+", " ",
             "o"}]}], "}"}]}], "\[IndentingNewLine]", "}"}]}], " ", ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"horizonLine", "[", "y_", "]"}], " ", "=", " ", 
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"dMin", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", " ", "y"}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"dr", ",", " ", "y"}], "}"}]}], "\[IndentingNewLine]", 
        "}"}]}], " ", ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Manipulate", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{"DateListPlot", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"min", ",", " ", "max", ",", " ", "close", ",", " ", 
              RowBox[{"dateFormLinearModel", "[", "0", "]"}], ",", " ", 
              RowBox[{"dateFormLinearModel", "[", "o", "]"}], ",", " ", 
              RowBox[{"horizonLine", "[", "v", "]"}]}], "}"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Filling", "\[Rule]", "Bottom"}], ",", " ", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotLabel", "\[Rule]", " ", 
             RowBox[{"Row", "[", 
              RowBox[{"{", 
               RowBox[{
               "lable", ",", " ", "\"\< (\>\"", ",", "nWeeks", ",", " ", 
                "\"\< weeks range)\>\""}], "}"}], " ", "]"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"PlotRange", " ", "\[Rule]", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"Automatic", ",", " ", "dr"}], "}"}], ",", " ", 
               RowBox[{"{", 
                RowBox[{"Automatic", ",", " ", 
                 RowBox[{"vMax", " ", "+", " ", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"vMax", "-", "vMin"}], ")"}], "/", "3"}]}]}], 
                "}"}]}], "}"}]}]}], "\[IndentingNewLine]", "]"}], 
          RowBox[{"(*", 
           RowBox[{",", "\[IndentingNewLine]", 
            RowBox[{"Plot", "[", "]"}]}], "*)"}], "\[IndentingNewLine]", 
          "}"}], "]"}], "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"o", ",", " ", 
            RowBox[{"-", "0.5"}]}], "}"}], ",", " ", 
          RowBox[{"-", "2"}], ",", " ", "2"}], "}"}], "\[IndentingNewLine]", 
        ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"v", ",", " ", 
            RowBox[{
             RowBox[{"close", "[", 
              RowBox[{"[", "len", "]"}], "]"}], "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", " ", "vMin", ",", 
          " ", 
          RowBox[{"vMax", " ", "+", " ", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"vMax", "-", "vMin"}], ")"}], "/", "3"}]}]}], "}"}]}], 
       "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{"Module", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"dis2", ",", " ", "n"}], "}"}], ",", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"n", " ", "=", " ", "3"}], " ", ";", "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"Row", "[", "{"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"fDataAndLinearModel", "[", " ", 
       RowBox[{"\"\<dis\>\"", ",", " ", "\"\<Disney\>\"", ",", " ", "8"}], 
       " ", "]"}], " ", "\[IndentingNewLine]", 
      RowBox[{"fDataAndLinearModel", "[", " ", 
       RowBox[{"\"\<dis\>\"", ",", " ", "\"\<Disney\>\"", ",", " ", "4"}], 
       " ", "]"}]}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"dis2", " ", "=", " ", 
     RowBox[{"fDataAndLinearModel", "[", " ", 
      RowBox[{"\"\<dis\>\"", ",", "n"}], " ", "]"}]}], " ", ";", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"plotDistAgainstLinearModel", "[", " ", 
     RowBox[{"dis2", ",", " ", "\"\<Disney\>\"", ",", " ", "n"}], " ", 
     "]"}]}]}], " ", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "]"}]}], "Input",
 CellChangeTimes->{{3.5942194418953514`*^9, 3.594219534127627*^9}, {
   3.5942196173573875`*^9, 3.5942196327492676`*^9}, {3.594219705982456*^9, 
   3.5942197276706967`*^9}, {3.594221690543967*^9, 3.594221767661378*^9}, {
   3.5942218362423*^9, 3.5942220310714436`*^9}, 3.594222061365176*^9, {
   3.5942221160603046`*^9, 3.594222119365494*^9}, 3.594222151757346*^9, {
   3.594222195382842*^9, 3.5942221990310507`*^9}, {3.594257640634925*^9, 
   3.59425765017747*^9}, {3.5942576801991873`*^9, 3.594257715700218*^9}, {
   3.5942577894574366`*^9, 3.5942579962062626`*^9}, {3.5942580932958155`*^9, 
   3.594258200148927*^9}, {3.59425827625228*^9, 3.5942584167063136`*^9}, {
   3.5942584481621127`*^9, 3.5942584482141156`*^9}, {3.5942584908895564`*^9, 
   3.5942584978679557`*^9}, 3.5942585324369326`*^9, {3.5942591671852384`*^9, 
   3.5942591672222404`*^9}, {3.5942595141500835`*^9, 3.59425953820946*^9}, 
   3.5942596175289965`*^9}],

Cell[BoxData[
 TagBox[
  StyleBox[
   DynamicModuleBox[{$CellContext`o$$ = -0.5, $CellContext`v$$ = 69.465, 
    Typeset`show$$ = True, Typeset`bookmarkList$$ = {}, 
    Typeset`bookmarkMode$$ = "Menu", Typeset`animator$$, Typeset`animvar$$ = 
    1, Typeset`name$$ = "\"untitled\"", Typeset`specs$$ = {{{
       Hold[$CellContext`o$$], -0.5}, -2, 2}, {{
       Hold[$CellContext`v$$], 70.2}, 66.72, 71.53333333333333}}, 
    Typeset`size$$ = {480., {168., 176.}}, Typeset`update$$ = 0, 
    Typeset`initDone$$, Typeset`skipInitDone$$ = 
    True, $CellContext`o$95957$$ = 0, $CellContext`v$95958$$ = 0}, 
    DynamicBox[Manipulate`ManipulateBoxes[
     1, StandardForm, 
      "Variables" :> {$CellContext`o$$ = -0.5, $CellContext`v$$ = 70.2}, 
      "ControllerVariables" :> {
        Hold[$CellContext`o$$, $CellContext`o$95957$$, 0], 
        Hold[$CellContext`v$$, $CellContext`v$95958$$, 0]}, 
      "OtherVariables" :> {
       Typeset`show$$, Typeset`bookmarkList$$, Typeset`bookmarkMode$$, 
        Typeset`animator$$, Typeset`animvar$$, Typeset`name$$, 
        Typeset`specs$$, Typeset`size$$, Typeset`update$$, Typeset`initDone$$,
         Typeset`skipInitDone$$}, "Body" :> Show[{
         DateListPlot[{$CellContext`min$95956, $CellContext`max$95956, \
$CellContext`close$95956, 
           $CellContext`dateFormLinearModel$95956[0], 
           $CellContext`dateFormLinearModel$95956[$CellContext`o$$], 
           $CellContext`horizonLine$95956[$CellContext`v$$]}, Filling -> 
          Bottom, Joined -> True, PlotLabel -> 
          Row[{"Disney", " (", 3, " weeks range)"}], 
          PlotRange -> {{Automatic, $CellContext`dr$95956}, {
            Automatic, $CellContext`vMax$95956 + ($CellContext`vMax$95956 - \
$CellContext`vMin$95956)/3}}]}], 
      "Specifications" :> {{{$CellContext`o$$, -0.5}, -2, 
         2}, {{$CellContext`v$$, 70.2}, 66.72, 71.53333333333333}}, 
      "Options" :> {}, "DefaultOptions" :> {}],
     ImageSizeCache->{543., {247., 254.}},
     SingleEvaluation->True],
    Deinitialization:>None,
    DynamicModuleValues:>{},
    SynchronousInitialization->True,
    UnsavedVariables:>{Typeset`initDone$$},
    UntrackedVariables:>{Typeset`size$$}], "Manipulate",
   Deployed->True,
   StripOnInput->False],
  Manipulate`InterpretManipulate[1]]], "Output",
 CellChangeTimes->{
  3.594219472849122*^9, 3.5942195399039574`*^9, {3.594222038751883*^9, 
   3.5942220632912865`*^9}, {3.594222121273603*^9, 3.594222153029419*^9}, 
   3.594222200729148*^9, 3.594257653460658*^9, {3.5942576929629173`*^9, 
   3.5942577170262938`*^9}, 3.5942577554044895`*^9, {3.59425780175414*^9, 
   3.594257824679452*^9}, {3.594257901986873*^9, 3.5942579209589586`*^9}, 
   3.5942579684076724`*^9, 3.594258000810526*^9, {3.5942581274957714`*^9, 
   3.5942581470918922`*^9}, 3.594258208542407*^9, 3.5942584009524126`*^9, {
   3.5942585042283196`*^9, 3.5942585340520253`*^9}, 3.5942591753207035`*^9, {
   3.59425951880835*^9, 3.594259545637885*^9}}]
}, Open  ]]
},
WindowSize->{1584, 765},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
FrontEndVersion->"9.0 for Microsoft Windows (64-bit) (January 25, 2013)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[557, 20, 18358, 399, 2441, "Input"],
Cell[18918, 421, 311, 7, 39, "Input"],
Cell[CellGroupData[{
Cell[19254, 432, 9343, 208, 1391, "Input"],
Cell[28600, 642, 2972, 55, 523, "Output"]
}, Open  ]]
}
]
*)

(* End of internal cache information *)
